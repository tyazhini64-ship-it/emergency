<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-CTZN Official | Chengalpattu Command</title>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #10b981;
            --danger: #ef4444;
            --bg: #f8fafc;
            --text: #000000;
            --card-bg: #ffffff;
            --border: #e2e8f0;
        }

        body { margin: 0; font-family:'Courier New', Courier, monospace; background: var(--bg); color: var(--text); display: flex; }

        /* Navigation */
        .sidebar { height: 100vh; width: 280px; position: fixed; background: var(--primary); color: white; display: flex; flex-direction: column; z-index: 1000; }
        .sidebar-header { padding: 30px; font-size: 1.5rem; font-weight: 800; color: var(--accent); border-bottom: 1px solid #334155; }
        .sidebar a { padding: 15px 30px; color: #94a3b8; text-decoration: none; border-left: 4px solid transparent; font-weight: 500; cursor: pointer; }
        .sidebar a:hover, .sidebar a.active { background: var(--secondary); color: white; border-left-color: var(--accent); }

        /* Main Area */
        .main { margin-left: 280px; width: calc(100% - 280px); min-height: 100vh; }
        
        /* Home Page Background Logic */
        #homeSection {
            min-height: 100vh;
            padding: 60px;
            box-sizing: border-box;
            background: linear-gradient(rgba(247, 249, 255, 0.8), rgba(255, 255, 255, 0.8)), 
                        url('pictures/bg.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            
            color: #000000;
        }

        .content-container { padding: 40px; }
        .card { background: var(--card-bg); padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.05); color: var(--text); }
        .home-stat-card { 
    background: rgba(0, 0, 0, 0.05); /* Light dark tint for contrast */
    backdrop-filter: blur(10px); 
    border: 1px solid rgba(0, 0, 0, 0.1); 
    color: #000000; /* Force black text */
    padding: 25px; 
    border-radius: 12px; 
}
        /* Form Styling */
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }
        .full-width { grid-column: span 2; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.8rem; text-transform: uppercase; color: #64748b; }
        input, select, textarea { padding: 12px; width: 100%; border-radius: 8px; border: 1px solid var(--border); background: #f1f5f9; box-sizing: border-box; }
        
        button { background: var(--accent); color: white; border: none; padding: 14px 24px; border-radius: 8px; cursor: pointer; font-weight: 700; text-transform: uppercase; }
        .btn-dispatch { background: var(--danger); width: 100%; margin-top: 20px; }

        /* Dashboard */
        .dashboard-columns { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        .emergency-card { border-left: 6px solid var(--border); padding: 15px; background: white; margin-bottom: 15px; border-radius: 4px; border: 1px solid var(--border); }
        .critical-high { border-left-color: var(--danger); }

        #loginOverlay { position: fixed; inset: 0; background: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 9999; }
        .login-card { background: white; padding: 40px; border-radius: 12px; width: 350px; text-align: center; color: var(--primary); }
        .hidden { display: none; }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-card">
        <h2>E-CTZN LOGIN</h2>
        <select id="userRole" style="margin: 20px 0;">
            <option value="User">Standard Responder</option>
            <option value="Admin">District Administrator</option>
        </select>
        <button onclick="Engine.login()" style="width: 100%;">Access System</button>
    </div>
</div>

<div class="sidebar">
    <div class="sidebar-header">E-CTZN</div>
    <a id="link-home" onclick="Engine.showSection('home')">Command Home</a>
    <a id="link-volunteer" onclick="Engine.showSection('volunteer')">Register Volunteer</a>
    <a id="link-task" onclick="Engine.showSection('task')">Report Emergency</a>
    <a id="link-dashboard" onclick="Engine.showSection('dashboard')">Live Dashboard</a>
</div>

<div class="main">
    <div id="homeSection">
        <h1 style="font-size: 3rem; margin-bottom: 10px;">Chengalpattu District</h1>
        <p style="font-size: 1.2rem; opacity: 0.9; margin-bottom: 40px;">Emergency Response & Skilled Volunteer Coordination</p>
        
        <div class="form-grid">
            <div class="home-stat-card">
                <span style="text-transform: uppercase; font-size: 0.8rem; font-weight: bold;">Verified Responders</span>
                <h2 id="statVols" style="font-size: 2.5rem; margin: 10px 0;">0</h2>
            </div>
            <div class="home-stat-card">
                <span style="text-transform: uppercase; font-size: 0.8rem; font-weight: bold;">Active Incidents</span>
                <h2 id="statIncidents" style="font-size: 2.5rem; margin: 10px 0;">0</h2>
            </div>
        </div>

        <div class="home-stat-card" style="margin-top: 30px; width: 100%; box-sizing: border-box;">
            <h3>Coverage Areas</h3>
            <p>Tambaram, Chengalpattu, Pallavaram, Maraimalai Nagar, Thiruporur, Mamallapuram, Nandivaram-Guduvancheri, Thirukalukundram.</p>
        </div>
    </div>

    <div id="volunteerSection" class="content-container hidden">
        <div class="card">
            <h3>Volunteer Enrollment</h3>
            <div class="form-grid">
                <div class="full-width"><label>Full Name</label><input type="text" id="volName"></div>
                <div><label>Town</label>
                    <select id="volLocation">
                        <option>Tambaram</option><option>Chengalpattu</option><option>Pallavaram</option>
                        <option>Maraimalai Nagar</option><option>Thiruporur</option><option>Mamallapuram</option>
                        <option>Nandivaram-Guduvancheri</option><option>Thirukalukundram</option>
                    </select>
                </div>
                <div><label>Tier</label><select id="volTier"><option value="3">Gold</option><option value="2">Silver</option><option value="1">Bronze</option></select></div>
                <div class="full-width">
                    <label>Skills</label>
                    <div style="display: flex; gap: 15px; background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <label><input type="checkbox" name="vskill" value="Medical Aid"> Medical Aid</label>
                        <label><input type="checkbox" name="vskill" value="Rescue"> Rescue</label>
                        <label><input type="checkbox" name="vskill" value="Logistics"> Logistics</label>
                    </div>
                </div>
                <button onclick="Engine.registerVolunteer()">Register Responder</button>
            </div>
        </div>
    </div>

    <div id="taskSection" class="content-container hidden">
        <div class="card">
            <h3>Emergency Dispatch Authority</h3>
            <div class="form-grid">
                <div><label>Incident</label><select id="taskType"><option>Fire</option><option>Medical</option><option>Flood</option></select></div>
                <div><label>Criticality</label><select id="taskCriticality"><option value="HIGH">Critical</option><option value="LOW">Routine</option></select></div>
                <div class="full-width"><label>Address</label><input type="text" id="taskAddress"></div>
                <div class="full-width">
                    <label>Resource Needed</label>
                    <div style="display: flex; gap: 15px; background: #f8fafc; padding: 15px; border-radius: 8px;">
                        <label><input type="checkbox" name="tskill" value="Medical Aid"> Medical Aid</label>
                        <label><input type="checkbox" name="tskill" value="Rescue"> Rescue</label>
                        <label><input type="checkbox" name="tskill" value="Logistics"> Logistics</label>
                    </div>
                </div>
                <button onclick="Engine.createIncident()" class="btn-dispatch">Authorize Dispatch</button>
            </div>
        </div>
    </div>

    <div id="dashboardSection" class="content-container hidden">
        <div class="dashboard-columns">
            <div><h4>Unattended</h4><div id="list-pending"></div></div>
            <div><h4>In Progress</h4><div id="list-progress"></div></div>
            <div><h4>Resolved</h4><div id="list-resolved"></div></div>
        </div>
    </div>
</div>

<script>
window.Engine = {
    role: "User",
    volunteers: JSON.parse(localStorage.getItem('vols_official')) || [],
    incidents: JSON.parse(localStorage.getItem('incs_official')) || [],

    login() {
        this.role = document.getElementById('userRole').value;
        document.getElementById('loginOverlay').style.display = 'none';
        this.showSection('home');
    },

    showSection(id) {
        ['homeSection', 'volunteerSection', 'taskSection', 'dashboardSection'].forEach(s => {
            const el = document.getElementById(s);
            if(el) el.style.display = 'none';
        });
        document.getElementById(id + (id === 'home' ? 'Section' : 'Section')).style.display = (id === 'home' ? 'block' : 'block');
        
        document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
        if(document.getElementById('link-' + id)) document.getElementById('link-' + id).classList.add('active');
        
        this.refreshStats();
        if(id === 'dashboard') this.renderDashboard();
    },

    registerVolunteer() {
        const skills = Array.from(document.querySelectorAll('input[name="vskill"]:checked')).map(i => i.value);
        const name = document.getElementById('volName').value;
        if(!name || skills.length === 0) return alert("Missing required credentials.");

        this.volunteers.push({
            name, skills, 
            location: document.getElementById('volLocation').value,
            tier: parseInt(document.getElementById('volTier').value)
        });
        this.save();
        alert("Responder Verified.");
        this.showSection('home');
    },

    createIncident() {
        const reqs = Array.from(document.querySelectorAll('input[name="tskill"]:checked')).map(i => i.value);
        const addr = document.getElementById('taskAddress').value;
        const loc = document.getElementById('volLocation').value; // Borrowing town from register for simplicity

        if(!addr || reqs.length === 0) return alert("Address and Skills Required.");

        const matches = this.volunteers.filter(v => v.skills.some(s => reqs.includes(s)));

        this.incidents.push({
            id: 'INC-' + Math.random().toString(36).substr(2, 4).toUpperCase(),
            type: document.getElementById('taskType').value,
            criticality: document.getElementById('taskCriticality').value,
            address: addr,
            status: matches.length > 0 ? 'IN_PROGRESS' : 'PENDING',
            responders: matches.slice(0, 2).map(m => m.name)
        });
        this.save();
        this.showSection('dashboard');
    },

    renderDashboard() {
        const containers = {
            PENDING: document.getElementById('list-pending'),
            IN_PROGRESS: document.getElementById('list-progress'),
            RESOLVED: document.getElementById('list-resolved')
        };
        Object.values(containers).forEach(c => c.innerHTML = '');

        this.incidents.forEach(inc => {
            const card = document.createElement('div');
            card.className = `emergency-card critical-${inc.criticality.toLowerCase()}`;
            card.innerHTML = `
                <div style="font-weight:bold">${inc.id}: ${inc.type}</div>
                <div style="font-size:0.8rem; color:#64748b">${inc.address}</div>
                <div style="font-size:0.7rem; margin-top:5px">Assigned: ${inc.responders.join(', ') || 'Pending'}</div>
            `;
            containers[inc.status].appendChild(card);
        });
    },

    refreshStats() {
        document.getElementById('statVols').innerText = this.volunteers.length;
        document.getElementById('statIncidents').innerText = this.incidents.filter(i => i.status !== 'RESOLVED').length;
    },

    save() {
        localStorage.setItem('vols_official', JSON.stringify(this.volunteers));
        localStorage.setItem('incs_official', JSON.stringify(this.incidents));
    }
};
</script>
</body>
</html>
