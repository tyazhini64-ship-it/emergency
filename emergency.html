<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-CTZN | Chengalpattu District Skill Volunteering</title>
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #10b981;
            --accent-hover: #059669;
            --bg: #f8fafc;
            --text: #334155;
            --card-bg: #ffffff;
            --border: #e2e8f0;
        }

        body { 
            margin: 0; 
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; 
            background: var(--bg); 
            color: var(--text);
            display: flex;
        }

        /* Login Overlay */
        #loginOverlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--primary);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }
        .login-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        /* Sidebar Navigation */
        .sidebar { 
            height: 100vh; width: 260px; position: fixed; 
            background-color: var(--primary); color: white;
            display: flex; flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.05); z-index: 1000;
        }
        .sidebar-header {
            padding: 30px 20px; font-size: 1.2rem; font-weight: bold;
            border-bottom: 1px solid rgba(255,255,255,0.1); color: var(--accent);
        }
        .sidebar a { 
            display: block; color: #cbd5e1; padding: 15px 25px; 
            text-decoration: none; font-weight: 500; transition: all 0.3s;
            border-left: 4px solid transparent;
        }
        .sidebar a:hover, .sidebar a.active { 
            background-color: var(--secondary); color: white; border-left: 4px solid var(--accent);
        }

        /* Main Content */
        .main { margin-left: 260px; padding: 40px; width: 100%; max-width: 1200px; }
        h2, h3 { color: var(--primary); margin-top: 0; }
        .card { 
            background: var(--card-bg); padding: 30px; border-radius: 12px; 
            margin-bottom: 30px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); border: 1px solid var(--border);
        }

        /* Home Section Background */
        #homeSection {
            background: linear-gradient(rgba(61, 80, 126, 0.85), rgba(15, 23, 42, 0.85)), url('pictures/bg.jpg');
            background-size: cover; background-position: center; padding: 40px; border-radius: 12px; color: white;
        }
        #homeSection .card { background: rgba(255, 255, 255, 0.1); color: white; backdrop-filter: blur(5px); border: 1px solid rgba(255,255,255,0.2); }
        
        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
        .full-width { grid-column: 1 / -1; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; }
        input, select { padding: 12px; width: 100%; border-radius: 8px; border: 1px solid var(--border); box-sizing: border-box; }
        
        button { 
            background: var(--accent); color: white; border: none; padding: 12px 20px;
            border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        button:hover { background: var(--accent-hover); }

        .checkbox-group { 
            display: grid; grid-template-columns: 1fr 1fr; gap: 10px; background: #f1f5f9; padding: 15px; border-radius: 8px;
        }

        /* Dashboard columns */
        .dashboard-columns { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .dashboard-column { border-radius: 12px; padding: 20px; min-height: 400px; background: #edf2f7; }
        .not-attended { border-top: 5px solid #ef4444; }
        .in-progress { border-top: 5px solid #f59e0b; }
        .attended { border-top: 5px solid #10b981; }
        .emergency-card { background: white; padding: 15px; border-radius: 8px; margin-bottom: 15px; font-size: 0.9rem; line-height: 1.4; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        
        .resolve-btn { background: var(--primary); font-size: 0.75rem; width: 100%; margin-top: 10px; }
        .hidden { display: none; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; text-align: center; color: var(--primary); }
    </style>
</head>
<body>

<div id="loginOverlay">
    <div class="login-card">
        <h2 style="color: var(--primary)">Welcome to E-CTZN</h2>
        <p>Chengalpattu District Emergency Response</p>
        <select id="userRole" style="margin-bottom: 20px;">
            <option value="User">Standard User (Report/Volunteer)</option>
            <option value="Admin">Administrator (Resolve Incidents)</option>
        </select>
        <button onclick="login()" style="width: 100%;">Enter Dashboard</button>
    </div>
</div>

<div class="sidebar">
    <div class="sidebar-header">E - CTZN</div>
    <a href="#" id="link-home" onclick="showSection('home')">Dashboard Home</a>
    <a href="#" id="link-volunteer" onclick="showSection('volunteer')">Register as Volunteer</a>
    <a href="#" id="link-task" onclick="showSection('task')">Report Emergency</a>
    <a href="#" id="link-dashboard" onclick="showSection('dashboard')">Live Incident Map</a>
    <a href="#" onclick="location.reload()" style="margin-top: auto; color: #ef4444;">Logout</a>
</div>

<div class="main">
    <div id="homeSection">
        <h2>Welcome, <span id="displayRole">User</span></h2>
        <p>Connecting verified skilled volunteers with real-time emergencies in Chengalpattu District.</p>
        <div class="stats">
            <div class="stat-card"><h3>Volunteers</h3><p id="totalVolunteers">0</p></div>
            <div class="stat-card"><h3>Emergencies</h3><p id="totalTasks">0</p></div>
        </div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="card"><h3>Safety Precautions</h3><ul><li>Stay Calm</li><li>Assess Surroundings</li><li>Shelter in place</li></ul></div>
            <div class="card"><h3>Past Mitigation Cases</h3><div id="pastCases">None.</div></div>
        </div>
    </div>

    <div id="volunteerSection" class="card hidden">
        <h3>Volunteer Registration</h3>
        <div class="form-grid">
            <div class="full-width"><label>Full Name</label><input type="text" id="volName"></div>
            <div>
                <label>Town/Municipality</label>
                <select id="volLocation">
                    <option>Tambaram</option>
                    <option>Chengalpattu</option>
                    <option>Pallavaram</option>
                    <option>Maraimalai Nagar</option>
                    <option>Thiruporur</option>
                    <option>Mamallapuram</option>
                    <option>Nandivaram-Guduvancheri</option>
                    <option>Thirukalukundram</option>
                </select>
            </div>
            <div><label>Verification</label><select id="volStatus"><option value="Verified">Verified Profile</option><option value="Not Verified">Pending</option></select></div>
            <div class="full-width">
                <label>Available Skills</label>
                <div class="checkbox-group" id="volSkills">
                    <label><input type="checkbox" value="Medical Aid"> Medical Aid</label>
                    <label><input type="checkbox" value="Rescue Operations"> Rescue Operations</label>
                    <label><input type="checkbox" value="Food Distribution"> Food Distribution</label>
                    <label><input type="checkbox" value="Counselling Assistance"> Counselling</label>
                </div>
            </div>
            <div class="full-width"><button onclick="addVolunteer()">Register</button></div>
        </div>
    </div>

    <div id="taskSection" class="card hidden">
        <h3>Report Emergency (Detailed)</h3>
        <div class="form-grid">
            <div><label>Emergency Type</label><select id="taskType"><option>Fire</option><option>Medical</option><option>Flood</option><option>Rescue</option></select></div>
            <div><label>Criticality</label><select id="taskCriticality"><option>High</option><option>Medium</option><option>Low</option></select></div>
            
            <div>
                <label>Town/Municipality</label>
                <select id="taskLocation">
                    <option>Tambaram</option>
                    <option>Chengalpattu</option>
                    <option>Pallavaram</option>
                    <option>Maraimalai Nagar</option>
                    <option>Thiruporur</option>
                    <option>Mamallapuram</option>
                    <option>Nandivaram-Guduvancheri</option>
                    <option>Thirukalukundram</option>
                </select>
            </div>
            <div><label>No. of People Affected (Est.)</label><input type="number" id="taskPeopleAffected" placeholder="e.g. 5"></div>

            <div><label>Estimated Time Aid Needed (Hrs)</label><input type="number" id="taskTimeNeeded" placeholder="4"></div>
            <div><label>Severity Score (1-10)</label><input type="number" id="taskAvailability" placeholder="10"></div>
            
            <div class="full-width">
                <label>Specific Location/Landmark</label>
                <input type="text" id="taskAddress" placeholder="e.g. Near Tambaram Railway Station">
            </div>

            <div class="full-width">
                <label>Required Services</label>
                <div class="checkbox-group" id="taskRequirements">
                    <label><input type="checkbox" value="Medical Aid"> Medical Aid</label>
                    <label><input type="checkbox" value="Rescue Operations"> Rescue Operations</label>
                    <label><input type="checkbox" value="Food Distribution"> Food Distribution</label>
                    <label><input type="checkbox" value="Counselling Assistance"> Counselling</label>
                </div>
            </div>

            <div class="full-width">
                <label>Equipment Needed</label>
                <input type="text" id="taskEquipment" placeholder="First Aid, Ropes, Boat, etc.">
            </div>

            <div class="full-width"><button onclick="addTask()" style="background: #ef4444;">Dispatch Emergency Alert</button></div>
        </div>
    </div>

    <div id="dashboardSection" class="hidden">
        <h3>Live Incident Dashboard | Chengalpattu District</h3>
        
        <div class="dashboard-columns">
            <div class="dashboard-column not-attended"><h4>üî¥ Unattended</h4><div id="notAttendedList"></div></div>
            <div class="dashboard-column in-progress"><h4>üü° In Progress</h4><div id="inProgressList"></div></div>
            <div class="dashboard-column attended"><h4>üü¢ Resolved</h4><div id="attendedList"></div></div>
        </div>
    </div>
</div>

<script>
let currentUserRole = "User";
let volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
let emergencies = JSON.parse(localStorage.getItem('emergencies')) || [];

function login() {
    currentUserRole = document.getElementById('userRole').value;
    document.getElementById('displayRole').innerText = currentUserRole;
    document.getElementById('loginOverlay').style.display = 'none';
    showSection('home');
}

function showSection(section){
    ['homeSection','volunteerSection','taskSection','dashboardSection'].forEach(s=>document.getElementById(s).classList.add('hidden'));
    document.getElementById(section+'Section').classList.remove('hidden');
    document.querySelectorAll('.sidebar a').forEach(a => a.classList.remove('active'));
    if(document.getElementById('link-' + section)) document.getElementById('link-' + section).classList.add('active');
    updateHomeStats();
    if(section=='dashboard') updateDashboard();
}

function addVolunteer() {
    const name = document.getElementById('volName').value;
    const location = document.getElementById('volLocation').value;
    const status = document.getElementById('volStatus').value;
    const skills = Array.from(document.querySelectorAll('#volSkills input[type=checkbox]:checked')).map(cb=>cb.value);
    
    volunteers.push({name, location, status, skills});
    localStorage.setItem('volunteers', JSON.stringify(volunteers));
    alert("Volunteer registered in " + location + "!"); 
    showSection('home');
}

function addTask() {
    const type = document.getElementById('taskType').value;
    const criticality = document.getElementById('taskCriticality').value;
    const location = document.getElementById('taskLocation').value;
    const availability = document.getElementById('taskAvailability').value;
    const peopleAffected = document.getElementById('taskPeopleAffected').value;
    const address = document.getElementById('taskAddress').value.trim();
    const equipment = document.getElementById('taskEquipment').value.trim();
    const requirements = Array.from(document.querySelectorAll('#taskRequirements input[type=checkbox]:checked')).map(cb=>cb.value);

    // Filter volunteers by specific Town and matching Skills
    const matchedVolunteers = volunteers.filter(v => 
        v.status === 'Verified' && 
        v.location === location && 
        v.skills.some(s => requirements.includes(s))
    );

    const status = (matchedVolunteers.length > 0) ? "In Progress" : "Not Attended";

    emergencies.push({
        type, criticality, location, address, peopleAffected, equipment, status, matchedVolunteers
    });

    localStorage.setItem('emergencies', JSON.stringify(emergencies));
    alert("Alert Dispatched to Verified Volunteers in " + location); 
    showSection('dashboard');
}

function resolveEmergency(index) {
    emergencies[index].status = 'Attended';
    localStorage.setItem('emergencies', JSON.stringify(emergencies));
    updateDashboard();
}

function updateDashboard(){
    ['notAttendedList', 'inProgressList', 'attendedList'].forEach(id => document.getElementById(id).innerHTML = '');
    
    emergencies.forEach((e, index) => {
        const resolveBtn = (currentUserRole === "Admin" && e.status !== 'Attended') 
            ? `<button class="resolve-btn" onclick="resolveEmergency(${index})">Mark Resolved</button>` 
            : '';

        const card = `<div class="emergency-card">
            <strong>${e.type} (${e.criticality})</strong><br>
            üìç <b>${e.location}</b>: ${e.address || 'Address Not Provided'}<br>
            üë• <b>Affected:</b> ${e.peopleAffected || 'Unknown'} | üõ†Ô∏è <b>Needs:</b> ${e.equipment || 'None'}<br>
            üë∑ <b>Responders:</b> ${e.matchedVolunteers.length > 0 ? e.matchedVolunteers.map(v=>v.name).join(', ') : 'None yet'}
            ${resolveBtn}
        </div>`;
        
        if(e.status == 'Attended') document.getElementById('attendedList').innerHTML += card;
        else if(e.status == 'In Progress') document.getElementById('inProgressList').innerHTML += card;
        else document.getElementById('notAttendedList').innerHTML += card;
    });
}

function updateHomeStats(){
    document.getElementById('totalVolunteers').innerText = volunteers.length;
    document.getElementById('totalTasks').innerText = emergencies.length;
}

updateHomeStats();
</script>
</body>
</html>
